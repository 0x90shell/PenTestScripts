#!/bin/bash

# This script makes IP ranges and removes out of scope IPs
# This requires our initial inscope and out of scope lists to be
# in a NMap parsable format
# Version 1.0

EXPECTED_ARGS=2

if [ $# -ne $EXPECTED_ARGS ]
then
	echo "This script requires two arguments, an inclusion list and exclusion list."
	echo "Both lists needs to be in a NMap parsable format"
	echo
	echo "./scopemaker.sh <inclusionlist> <exclusionlist>"
	exit
fi

# Use Nmap to create our IP lists
nmap -sL -n -iL $1 -oG inscope.list > /dev/null 2>&1
nmap -sL -n -iL $2 -oG outscope.list > /dev/null 2>&1

grep "Host" inscope.list | cut -d" " -f2 > iniplist.txt
grep "Host" outscope.list | cut -d" " -f2 > outiplist.txt

# Combine our two lists together
cat iniplist.txt outiplist.txt > totalips.txt

# Sort our list, and remove all duplicates
cat totalips.txt | sort -n -t . -k 1,1 -k 2,2 -k 3,3 -k 4,4 | uniq -u > inrangeiplist.txt

# Clean up extra files
rm inscope.list
rm outscope.list
rm iniplist.txt
rm outiplist.txt
rm totalips.txt
